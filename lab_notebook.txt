## 第一周

### 本周目标：
建立用于**结构预测**和**序列设计**的测试基准（benchmark）。

#### 周一 & 周二
* 目标
在Ubuntu中测试HowToMakeRotamerLibraries部分给出的make_inputs.bash脚本。
* 结果
将31行代码修改为sed -i "s/$phi_string/$phi/g" $output_in，32行代码做类似的修改，脚本即可正常运行。

* 目标
在PDB数据库中寻找包含非天然氨基酸（ncaa）的蛋白质-多肽复合物结构，确定整个计算流程的测试基准（benchmark）。
* 方法
1. PDB中检索（query）字段：( Full Text = "unnatural" OR Full Text = "non-canonical" ) AND Full Text = "peptide"。
2. 查看候选结果中的pdb是否符合要求。
？PDB检索字段不支持正则表达式
* 结果
从前200个候选结果中筛选，以表格形式记录，包括（年份，DOI，标题，POI，ncaa等信息，其中rank表示对候选者优劣排序），统计在ncaa-containing_complex.xlsx中（<https://github.com/phonez/grad_project/tree/master/benchmark>）。

#### 周三
* 目标
从表格中确定最终用于测试的benchmark。
* 方法
筛选文献的策略：
1. 对于肽段而言，除去C端和N端，每个位点是天然或非天然氨基酸。非天然氨基酸最好能够满足rosetta对ncaa的要求。
2. 尽可能给出详细的实验数据。针对文献中设计的非天然多肽，应给出抑制常数或IC50等数据，便于后续生化实验验证。
3. 蛋白质与多肽非共价结合。
4. 研究较多的蛋白质、使用频率较高的ncaa可以优先考虑。
5. 暂不考虑订书肽（或其它类似的constrained peptide）。
* 结果
完成一部分筛选，统计在benchmark.pptx中。

#### 周四
* 目标
从表格中确定最终用于测试的benchmark。
* 结果
完成筛选，统计在benchmark.pptx中（<https://github.com/phonez/grad_project/tree/master/benchmark>）。

#### 周五 & 周六
* 目标
在PDB数据库中寻找包含ncaa的蛋白质结构，用以验证：在【结构预测】过程中，给出的采样-打分体系对于正确预测包含ncaa的蛋白质结构是可靠的（能够很好地符合native蛋白质结构）。
* 方法
PDB中检索（query）字段：Full Text = ""unnatural amino acid"" OR Full Text = ""non-canonical amino acid"" 。

------------------------------------------------

## 第二周

### 本周目标
以4iww.pdb为例，使用rosetta构建一套**采样-打分体系**。

#### 周一 & 周二
* 目标 
以4iww.pdb为例，生成ncaa对应的params文件以及rosetta可读的pdb文件。
* 方法
1. 依照已经建立的流程，生成BP5.params文件。
2. 该结构为二聚体，从pymol中选出其中一条链（A链），除去水分子（solvent）和硫酸根离子，保留Co(II)，保存为4iww_A.pdb。
3. pdb文件中ncaa的原子类型为HETATM（非标准基团原子坐标），且原子编号与BP5.params文件给出的不符。做如下修改：HETATM改为ATOM，依据BP5.params文件和PDB中ATOM项格式对原子编号进行替换（手动替换）。
* 结果
1. 生成BP5.params文件过程中，发现molfile_to_params_polymer.py仍存在chi角指定不正确的bug。
2. 生成4iww_for_rosetta.pdb文件。

* 目标
在rosetta中读取4iww_for_rosetta.pdb文件和导入BP5.params文件，构建采样-打分体系。
* 方法
学习RosettaScripts的XML语法及各模块含义。

#### 周三 & 周四
* 目标
更新从非天然氨基酸mol2文件生成.params文件的流程。
* 方法
1. 运行gen_gaussian_input.py生成gjf文件（高斯输入文件）。方法，基组与关键词分别为：B3LYP，6-31G(d)，em=GD3BJ Opt=ModRedundant。
2. 运行runall.bash脚本计算所有gjf文件，生成log文件（高斯输入文件）。
3. 命令行下输入obabel -i g09 ./XXX.log -o mol -O ./XXX.mol，得到mol文件。
4. 运行gen_modified_molfile.py在mol文件文本最后加入ROOT等与原子树相关的信息。
5. 运行修改后的molfile_to_params_polymer.py，生成params文件。
6. 检验params文件的chi角是否指认正确（这是由于molfile_to_params_polymer.py仍存在bug，待更新）。
* 结果
相关python、bash脚本。（<https://github.com/phonez/grad_project/tree/master/gen_params_protocol/>）

#### 周五
* 目标
验证4iww_for_rosetta.pdb文件能被rosetta正确读入，同时验证BP5.params文件的正确性。
* 方法
对含有BP5的蛋白做relax，查看：
1. 在读入4iww_for_rosetta.pdb过程中是否报错（是否报告与params文件相关的错误）。
2. relax前后蛋白结构的变化是否合理。一般而言，打分更低，RMSD不会太大。
* 结果
4iww_for_rosetta.pdb和BP5.params文件均能被正确读入。

------------------------------------------------

## 第三周

### 本周目标
给出根据params文件修改含有ncaa的pdb文件的程序，并综合前期结果；在天然蛋白指定位点插入ncaa。

#### 周一 & 周二
* 目标
给出根据params文件修改含有ncaa的pdb文件的程序，并综合前期结果。
* 结果
1. 完整的gen_params_protocol：从初始结构mol2文件到params文件的系列脚本。
2. 针对4iww_A.pdb，初步完成对pdb中文件中ncaa部分进行修改的脚本。
3. pdb文件需要做初步的处理（去除水分子，去除盐离子，如果必要只保留多聚体中的一条链），这一步待自动化。
（<https://github.com/phonez/grad_project/tree/master/pipeline/>）

#### 周三 & 周四
* 目标
给出根据params文件修改含有ncaa的pdb文件的程序；读入带有ncaa的pdb，并进行结构优化。同时验证生成的params文件正确无误。
* 方法
在PyRosetta环境下，采用FastRelax()对蛋白质做结构优化，比较未修改的pdb文件（保留HETATM）和修改后的pdb文件蛋白质的打分。
* 结果
1. 修改pdb文件的脚本gen_modified_pdb.py。
2. 对蛋白质做结构优化的脚本relax_protein.py。
3. 对于4iww.pdb和BP5一例，打分合理，上述方法暂未发现问题。
（<https://github.com/phonez/grad_project/tree/master/validate_params_protocol/>）

#### 周五
* 目标
在天然蛋白指定位点突变成ncaa。
* 方法
1. 以4iww.pdb为例，pdb序号为133的氨基酸是BP5，考虑先把该位点突变回Ile，再检查能否成功突变成BP5。
2. 创建resfile，运行relax.mpi。
* 结果
1. 指定位点能够突变回Ile，但并未突变成BP5；运行过程中提示WARNING（including current in order to get at least 1 rotamer）
2. 猜测是缺少BP5.rotlib的缘故，不能构建BP5的rotamers。

------------------------------------------------

## 第四周

### 本周目标
在天然蛋白指定位点插入ncaa；读取带beta-ncaa的多肽链；在benchmark（PDB ID：4JJE）多肽链某些位点进行ncaa突变。

#### 周一
* 目标
在天然蛋白指定位点突变成ncaa。
* 方法
1. 猜测是缺少rotlib文件的缘故。创建一个五肽（AAAAA），在指定位点（如第二个氨基酸）突变成ornithine。rosetta中自带了ornithine的rotlib文件（$ROSETTA/main/database/rotamer/ncaa_rotlibs/ncaa_rotamer_libraries/alpha_amino_acid/C40.rotlib）。
2. 猜测是rosetta不能读取resfile中指定的ncaa（即X[<full name>]），将full name改成XXX（名为XXX的ncaa应当不存在于rosetta库中）。
* 结果
1. 运行过程中提示相同的WARNING，且指定位点没有突变成ornithine。说明不是缺少rotlib文件的缘故。
2. 运行过程中提示相同的WARNING，说明rosetta没有读取resfile中指定的ncaa。

#### 周二
* 目标
在天然蛋白指定位点突变成ncaa；生成beta-3-homo-leucine的params文件；生成rosetta能读取的含有beta-ncaa的肽段。
* 方法
1. 经比较，beta-3-homo-leucine与rosetta数据库beta-peptide中B3L.params对应的beta氨基酸一致（二者的命名不同）。
2. 将序列D-B3L-V-D通过pyrosetta中的dump_pdb()获得多肽链的pdb文件。
* 结果
1. 获得与caspase3结合的一条多肽链的pdb文件（位点突变的多肽链同理可以获得）。
2. 突变问题尚未解决。

#### 周三
* 目标
获取蛋白质-多肽复合物的pdb结构；考虑先采用从RosettaDock发展而来的FlexPepDock完成初步的对接（与Ligand Dock的比较？）。
* 方法
1. 在Pymol中，采用align的方法（align多肽D-B3L-V-D和蛋白质4JJE）将多肽放置在结合口袋附近。将caspase3.pdb（注：此处的caspase3蛋白质结构从蛋白质复合物4JJE.pdb截取而来，即结合配体的蛋白质结构）和D-B3L-V-D.pdb组合，导出complex_1.pdb。
2. relax导出的complex_1.pdb。
3. 参考（<https://onlinelibrary.wiley.com/doi/epdf/10.1002/prot.22716>，<https://doi.org/10.1371/journal.pone.0018934>，<https://doi.org/10.1371/journal.pcbi.1005905>），了解了FlexPepDock目前提供有三种方法（具体原理待更细致的研究）：refinement protocol，ab-initio protocol，PIPER-FlexPepDock。其适用性分别侧重于：PIPER-FlexPepDock侧重于多肽与蛋白质结合位点未知的情形；ab-initio protocol侧重于明确蛋白与多肽结合的大致区域，但缺少多肽骨架信息的情形；refinement protocol侧重于那些多肽与蛋白结合教接近正确解的模型（笛卡尔距离、phi/psi角）。由于采用align的方法放置多肽的位置，可以假设目前的模型接近正确解，于是选择采用refinement protocol。参照（<https://www.rosettacommons.org/demos/latest/public/refinement_of_protein_peptide_complex_using_FlexPepDock/README>），实现refinement protocol。具体分为两步：以relax后的蛋白质-多肽复合体为输入的蛋白质结构，进行prepack，得到complex_1.ppk.pdb；随后对prepack后的结构进行refine。
4. 重复方法1-3，将多肽序列换成DEVD。
* 结果
1. 得到complex_1.pdb。（注：保留了ANISOU和第17列的可替位置标识符）
2. relax过程中多次报错：“core.optimization.LineMinimizer: [ ERROR ] Inaccurate G! step= 7.45058e-09 Deriv= -1.29369 Finite Diff= 3.37687e+08”。查阅资料（<https://www.rosettacommons.org/node/11137>），了解：能量最小化过程是沿着构象势能面的梯度“向下”进行的，这一报错意味着在这一过程中能量反而升高，存在局部的、奇怪的结构。虽然不致影响最后的打分结果，但是会增加计算时长，降低采样效率。
3. prepack后的蛋白质的打分升高，这可能是由于在dock时采用的打分函数不同；refine过程中报错（core.conformation.Residue: [ ERROR ] New Residue cannot be aligned with template Residue, because the numbers of main-chain atoms differ.），猜测是不能兼容beta-aa的缘故（即B3L）。
4. 程序正常结束。验证了结果3中的结论，针对FlexPepDock Refinement暂时没有找到兼容beta-aa的解决方案（是否兼容ncaa？）。

#### 周四
* 目标
尝试解决FlexPepDock Refinement对beta-aa的兼容性问题；考虑采用DougsDockDesignMinimizeProtocol或Ligand Dock完成初步对接。
* 方法
1. 查阅（<http://flexpepdock.furmanlab.cs.huji.ac.il/usage.php>），了解：输入pdb文件中不能含有HETATM。修改prepack后的输入文件。
2. DougsDockDesignMinimizeProtocol是Douglas等人发展的用于重新设计蛋白多肽结合界面、评估ncaa突变对蛋白-多肽结合能力的影响的方法（doi:10.1371/journal.pone.0032637.g001）。该方法包含两层循环，外循环控制生成结构的数量；内循环控制设计流程，包括：
	- 扰动阶段：每次随机选择如下一种扰动，紧随着进行粗粒化的侧链优化（RotamerTrials？）。
		- 在结合口袋处，将多肽视为刚体，对整体施加旋转的和平移的位置扰动。
		- 对于多肽的所有残基，施加phi角和psi角的骨架扰动（smallMove和shearMove）。
		- 在结合口袋附近的、位于蛋白质上的残基，施加phi角和psi角的骨架扰动。
	- 设计阶段：在若干次扰动后，进行更细致的侧链优化（PackRotamers），随后
		- 主链、侧链二面角的能量最小化。
		- 多肽与蛋白质之间的能量最小化（jump between the peptide and protein?）。
参照（<https://new.rosettacommons.org/docs/latest/application_documentation/design/doug-dock-design-min-mod2-cal-cal>）。暂不清楚Rosetta如何定义beta-aa的psi角和phi角（可能需要修改Protocol，将其单独隔离，不参与多肽的骨架扰动？），猜测运行过程可能报错，考虑先设定外循环生成结构数量-nstruct为1，内循环次数-inner_num为1，每次设计需经历的扰动次数-pert_num为25。
3. 将2中内循环次数和每次设计需经历的扰动次数设置为默认值100。
* 结果
1. refine过程中报告相同的错误。考虑采用DougsDockDesignMinimizeProtocol方法进行测试。
2. 程序正常结束，但是ENERGY_DIFF报告为正值（约0.5），对比输出的复合物结构与输入的复合物结构，差异不大（RMSD<0.01），猜测是内循环次数和扰动次数过少，采样不充分导致。
3. 程序正常结束，ENERGY_DIFF报告为负值（-4.034），对比输出和输入（采用Pymol的align方法），RMSD为0.014；对比输出和输入中多肽的结构，RMSD为1.217。Pymol中的比对结果显示，相较于初始结构，多肽整体以平移地方式远离了结合口袋，但是骨架变动似乎并不大。对结果有如下三种可能的解释：接近正确结构；需要更多的尝试以接近正确结构；目前的尝试方法从原理上不能很好地处理beta-aa，因此难以达到正确结构。因此需要一种方法以检查DougsDockDesignMinimizeProtocol对于此例是否可行的。

#### 周五
* 目标
修改4JJE.pdb为rosetta可读的pdb文件，将原有的序列3Pal-D-βhLeu-hLeu-D替换为D-βhLeu-hLeu-D（inhibitor 2)；并分别突变成D-βhLeu-3Pal-D（inhibitor 4)，D-βhLeu-V-D（inhibitor 8)，（3-OMe)Phe-βhLeu-hLeu-D（inhibitor 3)；重置github上的grad_project下的文件结构。
* 方法
1. 依照此前构建的gen_modified_pdb.py，修改4JJE.pdb为rosetta可读的pdb文件。（注：删除了4JJE.pdb中多肽N端的ACE，删除了C端多余的一个C原子）
2. 运行relax，只允许多肽的残基构象发生变化（test_params.resfile），测试其构象是否合理（与原有的复合物结构相比，RMSD不会太大，一般小于1；打分合理，原子之间能保持原有的连接关系）。查阅Pyrosetta文档，找到针对不同分子的多种rmsd计算方法，如all_atom_rmsd，CA_rmsd，bb_rmsd等，这些方法分别对相应的原子做rmsd计算。这里选择pyrosetta.rosetta.core.scoring.all_atom_rmsd。
3. 假定D-βhLeu-hLeu-D与原有序列3Pal-D-βhLeu-hLeu-D后四个氨基酸的骨架位置、侧链构象均相近，为了得到含有D-βhLeu-hLeu-D的pdb文件，直接在原pdb文件中删除3Pal氨基酸对应的字段（或者使用Mover中的CutOutDomain?）。
4. 由于目前暂时不能从resfile中读取ncaa（可能是新版本的rosettta和pyrosetta的存在一些问题），采用Mover中的MutateResidue解决此问题。
* 结果
1. 得到4JJE_clean.pdb。
2. 得到4JJE_clean_relax.pdb，all_atom_RMSD为1.22，并不理想；且从Pymol中看，relax后蛋白质结构的构象也发生了变化，这与test_params.resfile所定义的不同。
3. 得到4JJE_clean_inhibitor_2.pdb。
4. 得到其他几个inhibitor的pdb结构。
5. 重置了github上的grad_project下的文件结构，各部分添加了README.md，commands.txt等。（<https://github.com/phonez/grad_project>）

------------------------------------------------

## 第五周

### 本周目标
针对不同多肽抑制剂，完成对复合物的结构优化，描述打分结果与文献中IC50的关系。

#### 周一
* 目标
在限制坐标的条件下，完成蛋白-多肽的结构优化；调整自由度，突变多肽上的氨基酸，完成蛋白-多肽的结构优化。
* 方法
1. 为初始结构（4JJE_clean_inhibitor_2.pdb）骨架重原子添加坐标限制势，使其不偏离初始输入的结构（-relax:constrain_relax_to_start_coords），调用relax方法做结构优化。这是由于：在Rosetta的评分体系中，即使是天然蛋白也会因为存在很多原子间的空间冲突（clash）导致评分急剧上升，被判定为结构不合理。如果不做结构优化，蛋白质本身的不合理结构而非抑制剂与蛋白结合的强度将会成为评分的主导因素，将无法通过打分的差异准确判断抑制剂与蛋白的结合能力的差异。
2. 关闭蛋白质骨架、侧链自由度，关闭多肽beta-aa骨架自由度（假定这些inhibitor中beta-aa的骨架相较于4JJE.pdb变动不大），进一步优化4JJE_opt_inhibitor_2的构象，同时给出多肽抑制剂的RMSD值（rmsd_all_heavy）。
* 结果
1. 获得4JJE_clean_inhibitor_2_opt.pdb，并将其视为天然结构以计算RMSD。Pymol的比对显示，优化后的结构相较于原始结构有一定偏离，在Pyrosetta中计算all_atom_rmsd，结果为1.30。
2. 获得4JJE_clean_inhibitor_2_opt_0001.pdb，RMSD为0.09，但是打分升高（从-775升高至-714）。

#### 周二
* 目标
对多肽上的氨基酸做ncaa突变，重复以上步骤，得到其它inhibitor的结果；对比后再调整结构优化的限制条件。
